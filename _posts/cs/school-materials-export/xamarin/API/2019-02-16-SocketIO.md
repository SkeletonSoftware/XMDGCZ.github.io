---
layout: post
title: "Socket IO "
categories:
    - "xamarin"
    - "API"
sort_index: 1
author: "David Malý"
--- 


## Socket.IO


Jan Hála







    Pomocí knihovny Socket.IO je možné vytvořit real-time komunikaci mezi zařízeními. Lze tedy napsat    například aplikaci, která bude spustitelná v jakémkoliv webovém prohlížeči, například karetní hru    využívající společně s knihovnou Socket.IO ještě serverový framework Node.JS.    My si ale nyní ukážeme, jak pomocí již zmíněné knihovny a frameworku, a za využití nástroje Xamarin a balíčku    SocketIoClientDotNet pro .NET navázat komunikaci mezi dvěma mobilními zařízeními.


### Klient


    Nejprve si ve vývojovém prostředí Visual Studio vytvoříme nový projekt, jeho Code Sharing Strategy    bude .NET Standart. Poté klikneme pravým tlačítkem na sdílenou část řešení aplikace, vybereme    Spravovat balíčku NuGet a nainstalujeme balíček SocketIoClientDotNet. Následně do projektu    do příslušných souborů vložíme následující kód:

**MainPage.xaml**
```

        
            
            
        
        
            
            
        

```
**MainPage.xaml.cs**
```

using Quobject.SocketIoClientDotNet.Client;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Xamarin.Forms;

namespace SocketIOapp
{public partial class MainPage : ContentPage{
        public Socket SocketIOvar { get; set; }
        //pri pouziti openode hostingu tuto adresu zjistite kliknutim na nazev vaseho hostingu
        public static string ServerURL = "http://socketioexamplexamarinapp.fr.openode.io/";
        List ConnectedUsers = new List();
        public MainPage()			{				InitializeComponent();			}

        private void ConnectionToTheServer_Clicked(object sender, EventArgs e)
        {
            connectionFormSL.IsVisible = false;
            SocketIOvar = IO.Socket(ServerURL);
            SocketIOvar.On(Socket.EVENT_CONNECT, () =>
            {
                Device.BeginInvokeOnMainThread(() =>
                {
                    afterConnectionToServerSL.IsVisible = true;
                    yourNicknameLBL.Text = yourNicknameEntry.Text;
                });

                SocketIOvar.Emit("connectToServer", yourNicknameEntry.Text);

                SocketIOvar.On("viewNewlyConnected", (newlyConnectedUser) =>
                {
                    string newUser = newlyConnectedUser.ToString();
                    Device.BeginInvokeOnMainThread(() =>
                    {
                        connectedUsersLV.ItemsSource = null;
                        ConnectedUsers.Add(newUser);
                        connectedUsersLV.ItemsSource = ConnectedUsers;
                    });
                });
            });
        }
    }
}
```

### Server


    K propojení dvou a více klientů potřebujeme vytvořit server. Na server se klient vždy připojí a    následně si od serveru například může vyžádat data o ostatních připojeních klientech apod.    Ke komunikaci mezi více mobilními zařízeními je potřeba Node.JS hosting poskytující veřejnou    ip adresu, k jeho vytvoření můžeme použít například OpeNode.io (https://www.openode.io/).    Na hosting umístíme následující následující soubory:

**app.json**
```

{
  "name": "socketio-server",
  "success_url": "/",
  "keywords": [
    "node",
    "express",
    "socket.io",
    "realtime",
    "websocket"
  ],
  "scripts": {
  },
  "addons": [
  ],
  "env": {
  }
}
```
**index.js**
```

var app = require('express')();
var http = require('http').Server(app);
var io = require('socket.io')(http);
var port = process.env.PORT || 3000;

http.listen(port, function(){
  console.log('listening on *:' + port);
});

io.sockets.on('connection', function(socket) {

    socket.on('connectToServer', function(nickname){
        socket.username = nickname;
        var string = "Uživatel " + socket.username + " se právě připojil.";
        socket.broadcast.emit('viewNewlyConnected', string);
        console.log("viewNewlyConnected: " + string);
    });

    socket.on('disconnect', function () {
        var string = "Uživatel " + socket.username + " se právě odpojil.";
        socket.broadcast.emit('viewNewlyConnected', string);
    });
});
```
**package.json**
```

{
  "name": "socketio-server",
  "version": "1.0",
  "dependencies": {
    "express": "^4.13.4",
    "request": "^2.83.0",
    "socket.io": "^1.4.5"
  },
  "scripts": {
    "start": "node index.js"
  }
}

```


    Nyní můžeme sestavit a nasadit aplikaci na platformy Android a UWP. Zadáme uživatelské jméno a    klikneme na připojit. V tu chvíli jsme připojeni na server a ten nám vždy zašle informaci ve chvíli,    kdy se některý uživatel připojí či odpojí.    Projekt je dostupný [ZDE](https://github.com/janhala/SocketIO_exampleApp) na Githubu.

