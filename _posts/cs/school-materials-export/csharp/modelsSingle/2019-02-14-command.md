---
layout: post
title: "Command "
categories:
    -"csharp"
    -"modelsSingle"
author: "David Malý"
--- 


## Command Pattern


Jakub Růženec



Command Pattern, někdy taky nazýván jako Action Pattern nebo Transaction Pattern, je návrhový vzor, který popisuje „encapsulaci" neboli zapouzdření požadavku jako objekt, tak aby jste mohli řadit nebo přihlašovat klienty s jinými požadavky.



Command Pattern je vždy spojován se 4 termíny: command, reciever, invoker a client. Command objekt ví o recieverovi a „invokuje" neboli vyvolá metodu recievera. Hodnoty parametrů od recievera jsou uloženy v commandu společně s objekty, které mají být zaslány. Reciever pak odvede práci, když je metoda execute() zavolána. Objekt invoker ví, jak poslat command a případně uloží informace o zaslaném commandu. Invoker neví nic o konkrétním commandu, ví pouze o rozhraní.



Invoker, command a reciever jsou objekty, které drží client, client rozhoduje, který reciever přiřadí ke commandu a který command přiřadí k invokeru. Client také rozhoduje o tom jaký příkaz má být kde proveden. Pro zaslaní commandu musí být command předán invokerovi.


### Příklady použití

- GUI tlačítka
- Nahrávání Macro - Command si umí pamatovat sekvenci Actionů.
- Vícenásobné Undo - Command pattern si může pamatovat všechny commandy co jste použili a následně se v nich umí vracet.
- Networking


### Command Pattern - UML Diagram a implementace


UML class diagram pro implementaci Command Patternu





 ![](images\command.png)
#### 1. Client


Tato třída vytváří a spouští objekt příkazu.


#### 2. Invoker


Požádá příkaz, aby provedl akci.


#### 3. Command


Rozhraní, které specifikuje operaci spuštění.


#### 4. ConcreteCommand


Tato třídá provádí **Execute** vyvoláním operace/í na **Receiver**.


#### 5. Receiver


Tato třída provádí **Action** spojenou s požadavkem.


### Zdrojový kód pro implementaci

```


public class Client
{ public void RunCommand() { Invoker invoker = new Invoker(); Receiver receiver = new Receiver(); ConcreteCommand command = new ConcreteCommand(receiver); command.Parameter = "Dot Net Tricks !!"; invoker.Command = command; invoker.ExecuteCommand(); }
}
 
public class Receiver
{ public void Action(string message) { 	Console.WriteLine("Action called with message: {0}", message); }
}
 
public class Invoker
{ public ICommand Command { get; set; }  public void ExecuteCommand() {	 Command.Execute(); }
}
 
public interface ICommand
{ void Execute();
}
 
public class ConcreteCommand : ICommand
{ protected Receiver _receiver; public string Parameter { get; set; }  public ConcreteCommand(Receiver receiver) { 	_receiver = receiver; }  public void Execute() { 	_receiver.Action(Parameter); }
}


```

### Vzorový kód


Představte si jednoduchý vypínač. V tomto příkladě nakonfigurujeme vypínač pomocí 2 Commandů: vypnutí světla a zapnutí.



Tento příklad můžete využít na jakýkoli příkaz typu: „Vypnout/Zapnout", „Ano/Ne" a podobně.



Nejdříve si založíme Command rohraní:


```


    public interface ICommand
    {
        void Execute();
    }


```


Jako další si musíme udělat třídu Invoker:


```


    public class Switch
    {
        private List< ICommand > _commands = new List< ICommand >();

        public void StoreAndExecute(ICommand command)
        {
            _commands.Add(command);
            command.Execute();
        }
    }


```


Nyní uděláme Reciever třídu, kde napíšeme Action a v tomto případě i to co chceme vypsat.


```


    public class Light
    {
        public void TurnOn()
        {
            Console.WriteLine("Svetlo sviti");
        }

        public void TurnOff()
        {
            Console.WriteLine("Svetlo nesviti");
        }
    }


```


Příkaz pro rozsvícení světla - „ConcreteCommand" #1


```


    public class FlipUpCommand : ICommand
    {
        private Light _light;

        public FlipUpCommand(Light light)
        {
            _light = light;
        }

        public void Execute()
        {
            _light.TurnOn();
        }
    }


```


Příkaz pro zhasnutí světla - „ConcreteCommand" #2


```



    public class FlipDownCommand : ICommand
    {
        private Light _light;

        public FlipDownCommand(Light light)
        {
            _light = light;
        }

        public void Execute()
        {
            _light.TurnOff();
        }
    }


```


A nakonec napíšeme následující:


```




    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("Napis prikaz (zap/vyp) : ");
            string cmd = Console.ReadLine();

            Light lamp = new Light();
            ICommand switchUp = new FlipUpCommand(lamp);
            ICommand switchDown = new FlipDownCommand(lamp);

            Switch s = new Switch();

            if (cmd == "zap")
            {
                s.StoreAndExecute(switchUp);
            }
            else if (cmd == "vyp")
            {
                s.StoreAndExecute(switchDown);
            }
            else
            {
                Console.WriteLine("Zadejte \"zap\" nebo \"vyp\"");
            }

            Console.ReadKey();
        }
    }


```


Výstup z konzole:



![](images\output.png)



A to je vše, jednoduché jako facka.


### Kdy použít:

- Když potřebujete opakovaně volat funkce.
- Když potřebujete posílat požadavky ruzným příjemcům, kteří je umí vyřešit různými způsoby.
- Když chcete program ovládát příkazy.


### Zdroje:
[Wikipedia.org](https://en.wikipedia.org/wiki/Command_pattern)[dotnettricks.com](http://www.dotnettricks.com/learn/designpatterns/command-design-pattern-dotnet)[dofactory.com](http://www.dofactory.com/net/command-design-pattern)