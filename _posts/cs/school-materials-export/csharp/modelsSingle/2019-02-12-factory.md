##   Factory Pattern

Tomáš Chalupa

 Návrhový vzor Factory slouží k vytváření instancí objektů určitého typu (někdy označovaných jako Produkt).

Základní metodou vytváření instancí v objektově orientovaných jazycích je volání konstruktoru třídy za použití operátoru 'new' (nebo jeho variant). Tento způsob ale nemusí být vždy vhodný. Vytvoření a inicializace objektu mohou vyžadovat řadu parametrů, které nemusí být k dispozici v místě kódu, odkud se konstruktor volá. Někdy zase potřebujeme konstruovat objekty, které implementují určité rozhraní, ale neznáme typ objektu, který se má v aktuálním kontextu vytvořit a nemůžeme proto přímo volat konstruktor konkrétního typu. V těchto případech můžeme použít návrhový vzor Factory, který umožňuje delegování procesu vytváření a inicializace instancí objektu do k tomu určené metody nebo třídy.

 V návrhovém vzoru Factory se využívá dědičnosti. Předpokládá se, že všechny konkrétní typy instancí, které Factory produkuje, implementují společné rozhraní, nebo jsou potomky společné základní třídy. Volající kód se pak odkazuje pouze na společné rozhraní a nepotřebuje znát konkrétní typy objektů.

### Factory Method

Existuje více variant návrhového vzoru Factory. Nejjednodušší variantou je konkrétní třída, která implementuje tzv. Factory Method. Tato metoda vrací konkrétní instanci produktu na základě aktuálních parametrů nebo kontextu. 

![Factory Method](images/factory1.png)

### Abstract Factory

Složitější variantou je návrhový vzor Abstract Factory. V tomto případě existuje rozhraní nebo abstraktní třída, která obsahuje abstraktní Factory metodu (např. *CreateProduct()*). Konkrétní implementace tohoto rozhraní (nebo abstraktní třídy) pak slouží k vytváření objektů konkrétního typu. Klient funguje pouze proti obecnému rozhraní Factory a nepotřebuje znát konkrétní implementaci. Ta může být vytvořena jinde v aplikaci (např. pomocí dependency injection).

![Abstract Factory](images/factory2.png)

### Příklad

Tento příklad využití návrhového vzoru Factory Pattern ukazuje vytvoření instance třídy, reprezentující hudební nástroj, který je právě nastaven. 

Všechny hudební nástroje v programu implementují rozhraní *INastroj*. Třída *NastrojFactory* ví, jaký nástroj je aktuálně nastaven a podle toho vytvoří a vrátí požadovanou instanci třídy konkrétního nástroje (metoda *VytvorNastroj()*).

    <code class="language-C# ">class NastrojFactory {

            private string nastavenyNastroj;

            public INastroj VytvorNastroj() {
                        INastroj nastroj = null;
                        switch (nastavenyNastroj) {
                                    case "kytara":
                                            nastroj = new Kytara();
                                            break;
                                    case "ukulele":
                                            nastroj = new Ukulele();
                                            break;
                                    case "banjo":
                                            nastroj = new Banjo();
                                            break;
                        }
                        return nastroj;
            }
    }</code>

 V jiné třídě v programu je poté možné získat aktuálně nastavený nástroj, aniž by daná třída toto nastavení znala. 

    <code class="language-C# ">NastrojFactory nastrojFactory = new NastrojFactory();
    INastroj nastroj = nastrojFactory.VytvorNastroj();</code>