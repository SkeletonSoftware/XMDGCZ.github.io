---
layout: post
title: "reddit.php "
categories:
    -"csharp"
    -"csharp"
author: "David Malý"
--- 


##   Reddit API


Pavel Flegr



Reddit poskytuje extenzivní API umožňující prohlížení i postování příspěvků a správu účtu. Lze tedy využít na vytvoření alternativního klienta pro použití redditu nebo bota, který shromažďuje informace nebo reaguje na příspěvky ostatních.



Jednoduché prohlížení příspěvků využívá stejné adresy jako normální reddit, akorát se za ně přidá .json<br>    V příkladech je použita knihovna RestSharp.<br>    Pro vytvoření potřebných tříd z vráceného textu lze použít http://json2csharp.com/


```

//vrátí seznam příspěvků ze subredditu včetně jejich id
var request = new RestRequest("r/cats.json");
var json = client.Execute(request).Content;

```

```

//vrátí obsah příspěvku a komentáře
var request = new RestRequest("r/cats/8c6wqm.json");
var json = client.Execute(request).Content;

```


Pro použití některých funkcí týkajících se třeba informací o účtu nebo postování komentářů je vyžadována autentizace pomocí OAUTH. K tomu slouží tato [stránka](https://www.reddit.com/prefs/apps) (je třeba se přihlásit). V dolní části je tlačítko sloužící k registraci aplikace.



Je třeba vyplnit název a adresu pro přesměrování. Adresa přesměrování může být i localhost a ne vždy je použita.



Reddit rozlišuje 3 typy aplikací - internetová, instalovaná a skript.<br>
- internetová aplikace využívá api jen na straně serveru a je tedy pro reddit důvěryhodná. Použije se pro třeba aplikace, které shromažďují a zpřístupňují ostatním nějaké informace.
- instalovaná aplikace může být využena kýmkoliv a není tedy důvěryhodná. Bude použita na např. pro alternativního klienta.
- skript je využíván pouze vývojářem a je tedy důvěryhodný. Má ale přístup pouze k účtu vývojáře, ne k ostatním.



Při úspěšném vytvoření bude aplikace přidána do seznamu pod názvem obsahuje client\_id a také secret, které budou potřeba později (pokud neobsahuje secret je třeba použít místo něj "nosecret")



Po zaregistrování aplikace je třeba už v samotné aplikaci získat autorizační token.


```

//třída pro vrácený JSON:
class AccesToken
{public string access_token { get; set; }public string token_type { get; set; }public string expires_in { get; set; }public string scope { get; set; }
}

```

```

var client = new RestClient("https://www.reddit.com/api/v1/");
var request = new RestRequest("access_token", Method.POST);
//client_id a secret nahradit za hodnoty přiřazené aplikaci
request.Credentials = new System.Net.NetworkCredential("client_id", "secret");

```


dále je třeba vybrat jednu ze situací


- <br>        Pro skripty nebo aplikace, které nepotřebují účet vývojáře:<br>        
```

request.AddParameter("grant_type", "https://oauth.reddit.com/grants/installed_client");
//id obsahuje 20-30 znaků by mělo být unikátní pro každé zařízení. Může být třeba náhodně generované nebo může být "DO_NOT_TRACK_THIS_DEVICE" aby nebylo používáno
request.AddParameter("device_id", "aaaaaaaaaaaaaaaaaaaaa");

```
- <br>        Pro skripty nebo aplikace, které využívají účet vývojáře:<br>        
```

request.AddParameter("grant_type", "client_credentials");

```
- <br>        Pro aplikace, které potřebují účet uživatele:<br>            Pokud je třeba použít účet uživatele aplikace musí požádat o jeho povolení. K tomu je použit odkaz v tomto formátu: https://www.reddit.com/api/v1/authorize?client\_id=CLIENT\_ID&response\_type=temporary&<br>            state=neco&redirect\_uri=URI&duration=temporary&scope=code (client\_id a redirect\_uri podle registrované aplikace, scope obsahuje hodnoty, které aplikace bude potřebovat podle použitých požadavků oddělené mezerami)

    Prohlížeč pak bude přesměrován na použitou adresu a součástí query je parametr code. Ten je potřeba z adresy extrahovat a použít pro získání tokenu:


```

//request.AddParameter("grant_type", "client_credentials");
request.AddParameter("grant_type", "authorization_code");
request.AddParameter("code", "získaný code");
request.AddParameter("redirect_uri", "http://locahost");

```


```

var token = request.execute().Data.access_token;

```


Token pak lze použít pro tato [API](https://www.reddit.com/dev/api). Zde je příklad.


```

//pro autentizované požadavky se mění adresa
client.BaseUrl = new Uri("https://oauth.reddit.com/");
request = new RestRequest("api/v1/me", Method.GET);
//je třeba přidat získaný token
request.AddParameter("Authorization", "bearer " + token, ParameterType.HttpHeader);
var response = client.Execute(request);

```
