---
layout: post
title: "Get a Post "
categories:
    -"csharp"
    -"api"
author: "David Malý"
--- 


## Get dotaz


<br>    Získání vtipu o Chucku Norrisovi z webové API.<br>



<br>    Dotaz lze provést pomocí třídy HttpClient, která se nachází v System.Net.Http a je součástí .Net Framework.<br>



<br>    Pro deserializaci je použita knihovna [Json.NET](https://www.newtonsoft.com/json).<br>



<br>    Api pro vtipy je: https://api.chucknorris.io


### Dynamic

```

public async void Send()
{
    // Vytvoření klienta
    HttpClient client = new HttpClient();

    // Odeslání dotazu na API + pamaretr pro výpis z kategorie dev
    var response = await client.GetAsync("https://api.chucknorris.io/jokes/random?category=dev" );

    // Získání odpovědi v Json
    string json = await response.Content.ReadAsStringAsync();

    // Deserializace na dynamic objekt
    dynamic c = JsonConvert.DeserializeObject(json);

    // Vypsání z Dynamic
    string joke = c.value;
}

```

### Striktně typové - třída


<br>    Ideální je vytvořit třídu dle struktury dat, které přijdou v odpovědi API. Na to je mnoho nástrojů např. [json2C#](http://json2csharp.com/), kam stačí zadat json z odpovědi a vygeneruje se potřebný kód pro třídu v C#.<br>



<br>    Pro výše použitou API vypadá třída následovně:<br>


```

class JokeFromApi
{
    public List&ltstring> category { get; set; }
    public string icon_url { get; set; }
    public string id { get; set; }
    public string url { get; set; }
    public string value { get; set; }
}

```


<br>    Výsledný kód se poté liší pouze v deserializaci, kde je třída použita:<br>


```

public async void Send()
{
    // Vytvoření klienta
    HttpClient client = new HttpClient();

    // Odeslání dotazu na API + pamaretr pro výpis z kategorie dev
    var response = await client.GetAsync("https://api.chucknorris.io/jokes/random?category=dev" );

    // Získání odpovědi v Json
    string json = await response.Content.ReadAsStringAsync();

    // Deserializace na JokeFromApi objekt
    JokeFromApi c = JsonConvert.DeserializeObject&ltJokeFromApi>(json);

    // Vypsání z JokeFromApi objektu
    string joke = c.value;
}

```

## Post dotaz


<br>    Post dotaz se píše podobným způsobem jako GET. Místo GetAsync je použita metoda SendAsync s kustomizovaným dotazem pro POST.<br>



<br>    K dotazu jsou v ukázce připojena i data.<br>


```

public async void Send()
{
    // Vytvoření klienta
    var client = new HttpClient();

    var request = new HttpRequestMessage(HttpMethod.Post, "https://ucitel.sps-prosek.cz/~maly/PRG/json.php");

    // Data, která se přidají k POST dotazu -> klíč je typu string a data jsou typu string
    var keyValues = new List&ltKeyValuePair&ltstring, string>>();
    keyValues.Add(new KeyValuePair&ltstring, string>("klíč", "data"));

    // Přidání dat do dotazu
    request.Content = new FormUrlEncodedContent(keyValues);

    // Zaslání POST dotazu
    var response = await client.SendAsync(request);

    // Získání odpovědi
    string responseContent = await response.Content.ReadAsStringAsync();
}

```
