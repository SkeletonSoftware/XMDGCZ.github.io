---
layout: post
title: "rest.php "
categories:
    -"csharp"
    -"csharp"
author: "David Malý"
--- 


## RestAPI


Václav Mencl



<br>    REST je jednoduchý způsob jak vytvořit, číst, editovat nebo smazat informace ze serveru pomocí jednoduchého volání HTTP<br>



<br>    Jedná se o architekturu rozhraní, navržená pro distribuované prostředí.<br>    Rozhraní REST je použitelné pro jednotný a snadný přístup ke zdrojům (zdroje => data) nebo stavům aplikace.<br>    REST je orientováno datově, ne procedurálně.<br>    Všechny zdroje mají vlastní identifikátor URI a REST definuje čtyři základní metody pro přístup k nim.<br>


### Metody pro přístup


REST obsahuje čtyři základní metody, označovány jako CRUD:



| Seznam Metod  |
| --- |
| Create - Vytvoření dat |
| Retrieve - Získání dat |
| Update - Změnu dat |
| Delete - Smazání dat |



Implementace metod probíhá pomocí odpovídajícího protokolu HTTP


### Create (POST)


<br>    Vytvoření dat je velmi jednoduché. K Vytvoření dat slouží metoda POST, známá z HTML formulářů. Při volání metody POST není známy přesný identifikátor zdroje (protože ještě neexistuje). Proto je pro POST domluvený společný identifikátor: **endpoint** .<br>





*Příklad služby Twitter:<br>





<br>    Vytvoření dat (zprávy) je potřeba zavolat zdroj s URI "/statuses/update" pomocí HTTP metody POST. Kdy v parametru "status" je předávána zpráva pro novou zprávu. K vytvoření nové zprávy je potřeba autorizace uživatelských dat, twitter podporuje dvě autentizace: prostá autentizace nebo OAuth. OAuth je na vyšší úrovní zabezpečení, oproti prostému HTTP autentizaci, při niž se posílá jméno a heslo v otevřeném textu.<br>





<br><br>    Ukázka použití prosté HTTP autentizace za pomocí POST metody:*
```

curl -u user:password -d "status=Zkousime REST API" http://twitter.com/statuses/update.xml

```


<br>    Po odeslání by server měl vrátit určitý kód HTTP, v tomto případě: 201 - Created<br>


### Retrieve (GET)


Základní metoda pro přístup k datům je získání zdroje pomocí metody GET, taktéž známá z formulářů HTML.

*Ukázka požadavku na stránku:*
```

GET /api/user/vaclav
HOST: www.server.cz

```


Podle REST má každý zdroj svůj vlastní identifikátor (URI). Pomocí HTTP GET požadavku lze získat data konkrétního zdroje.



*Ukázka získání posledních zpráv uživatele VaclavMencl na twitteru.<br>        Podle dokumentace Twitteru lze získat zprávy konkrétního uživatele jako zdroj "/statuses/user\_timeline". Přesný tvar je:<br>        
```

http://twitter.com/statuses/user_timeline/uživatel.formát

```
Data uživatele získáme pomocí HTTP požadavku:*


```

GET /statuses/user_timeline/VaclavMencl.xml
HOST: twitter.com

```

### DELETE


Zdroj lze smazat pomocí volání URI HTTP metodou DELETE. Volání metody je podobné jako volání metody GET


```

DELETE /api/user/vaclav
HOST: www.server.cz

```


U metody DELETE může dojít k problému vyvolaném tím, že některé nástroje či HTML formuláře jsou omezené pouze na metody POST a GET.<br>    V praxi se proto použivájí náhradní způsoby: volání POST s určitým parametrem, který sděluje, že ve skutečnosti byla použita metoda DELETE, nebo pomocí speciální URI:


```

http://twitter.com/statuses/destroy/číslo.formát

```


Jestliže se, ale setkáme s nástrojem který DELETE podporuje, lze metodu vyvolat pomocí:


```

curl -u user:password --http-request DELETE http://twitter.com/statuses/destroy/1472669360.xml

```

### Update (PUT)


Metoda změny je podobná jako metoda vytvoření (POST), pouze s tím rozdílem, že voláme konkrétní URI konkrétního zdroje, který chceme změnit. V těle předáváme novou hodnotu.<br>    U metody PUT platí to samé co u metody DELETE.<br>    Taktéž ne každý nástroj či formulář ji podporuje, proto některá REST API použivájí jiné řešení.

*Ukázka:*
```

DELETE /api/user/vaclav
HOST: www.server.cz

```

```

curl -u user:password -d "url=http://vaclav.mencl.cz" http://twitter.com/account/update_profile.xml

```

### Stavové Kódy


| Stavové Kódy |
| --- |
| 200 OK | Požadavek proběhl v pořádku |
| 201 Created | Při POST, jestliže došlo k vytvoření nového obsahu |
| 204 No Content | Požadavek proběhne v pořádku, ale server nic nevrátí |
| 304 No Modified | Pokud nedošlo od posledního požadavku ke změně obsahu |
| 400 Bad Request | Jestliže došlo k nečitelnosti požadavku na serveru |
| 401 Unauthorized | Klient není ověřen |
| 403 Forbidden | Klient nemá přístup k danému obsahu |
| 404 Not Found | Zdroj nebyl nalezen |
| 405 Method not Allowed | Zdroj nepovoluje tuto metodu |
| 410 Gone | Zdroj není dostupný |
| 415 Unsupported Media Type | Uvedená hlavička "Content-Type", není podporována |
| 422 Unprocessable Entity | Chyba validace dat - např. u formuláře |
| 429 Too-Many Requests | Pokud klient překročil maximální počet požadavků na den |


### Ukázka metody POST a GET pomocí C# (Bing Maps)

#### Použité Using

```

using BingMapsRESTToolkit;

```

#### Vytvoření Session


*Ukázka zobrazuje jak vytvořit Session Klíč k instanci "Bing Mapám"*


```

Map.CredentialsProvider.GetCredentials((c) =>
{
    string sessionKey = c.ApplicationId;

});

```

##### CredentialsProvider Class


Pověření používané mapou ke kontrole



| Konstruktor |
| --- |
| CredentialsProvider() |



| Metody |
| --- |
| Equals(Object) |
| Finalize() |
| GetCredentials(Action) |
| GetHashCode() |
| GetType() |
| MemberwiseClone() |
| MemberwiseClone() |
| ToString() |


#### HTTP GET Metoda


*Využití metody GET s požadavkem na "Bing Mapy"*


```

private void GetResponse(Uri uri, Action callback)
{
    WebClient wc = new WebClient();
    wc.OpenReadCompleted += (o, a) =>
    {
        if (callback != null)
        {
            DataContractJsonSerializer ser = new DataContractJsonSerializer(typeof(Response));
            callback(ser.ReadObject(a.Result) as Response);
        }
    };
    wc.OpenReadAsync(uri);
}

```

#### HTTP POST Metoda


*Použití metody HTTP POST s požadavkem na "Bing Mapy". Přičemž "Bing Mapy" podporují POST protokol.*


```

private void GetPOSTResponse(Uri uri, string data, Action callback)
{
    HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(uri);

    request.Method = "POST";
    request.ContentType = "text/plain;charset=utf-8";

    System.Text.UTF8Encoding encoding = new System.Text.UTF8Encoding();
    byte[] bytes = encoding.GetBytes(data);

    request.ContentLength = bytes.Length;

    using (Stream requestStream = request.GetRequestStream())
    {
        requestStream.Write(bytes, 0, bytes.Length);
    }

    request.BeginGetResponse((x) =>
    {
        using (HttpWebResponse response = (HttpWebResponse)request.EndGetResponse(x))
        {
            if (callback != null)
            {
                DataContractJsonSerializer ser = new DataContractJsonSerializer(typeof(Response));
                callback(ser.ReadObject(response.GetResponseStream()) as Response);
            }
        }
    }, null);
}

```

#### Implementace žádosti


*Ukázka HTTP GET požadavku na REST službu "Bing Map". Tento příklad zobrazí adresu "Novoborská, 190 00 Praha, Česká republika"*


```

string key = "YOUR_BING_MAPS_KEY or SESSION_KEY";
string query = "Novoborská, 190 00 Praha, Česká republika ";

Uri geocodeRequest = new Uri(string.Format("http://dev.virtualearth.net/REST/v1/Locations?q={0}&key={1}", query, key));

GetResponse(geocodeRequest, (x) =>
{
    Console.WriteLine(x.ResourceSets[0].Resources.Length + " result(s) found.");
    Console.ReadLine();
});

```

#### Zdroje
https://www.zdrojak.cz/clanky/rest-architektura-pro-webove-api/http://www.itnetwork.cz/nezarazene/stoparuv-pruvodce-rest-api[https://cs.wikipedia.org/wiki/Representational\_State\_Transfer](https://cs.wikipedia.org/wiki/Representational_State_Transfer)https://msdn.microsoft.com/en-us/library/jj819168.aspx